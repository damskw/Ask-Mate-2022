{% extends "layout.html" %}
{% block title %}Ask Mate{% endblock %}
{% block content %}
    <div class="questions-all">
        <div class="single-question">
            <h1 id="question-title">{{ question.title }}</h1>
            Added on {{ question.submission_time }}, View Number: {{ question.view_number }}, Vote
            Number: {{ question.vote_number }}
            <br>
            <a href='/question/{{ question.id }}/vote-up'><i id="circle-up" class="fa-sharp fa-solid fa-circle-up"></i></a>
            <a href='/question/{{ question.id }}/vote-down'><i id="circle-down"
                                                               class="fa-sharp fa-solid fa-circle-down"></i></a>
            <div class="question-message">{{ question.message }}</div>


            <br><br>
            {% if question.image != None and question.image != '' %}
                <h3>Attachements:</h3>
                {% set question_image='images/' ~ question.image %}
                <img src="{{ url_for('static', filename=question_image) }}" style="width:60px;height:50px;">
                <br><br>
            {% endif %}
            <div class="w3-small">
                <a href="/question/{{ question.id }}/delete">
                    <button class="w3-button w3-black" type="submit">DELETE THIS QUESTION</button>
                </a>
                <a href="/question/{{ question.id }}/edit">
                    <button class="w3-button w3-black" type="submit">EDIT THIS QUESTION</button>
                </a>
                <br><br><br>
            </div>
            {% if question_comments is defined %}
                <h4>{{ question_comments|length }} Comments:</h4>
                {% for comment in question_comments %}
                    Added on {{ comment.submission_time }}, Edit numbers: {{ comment.edited_count }}
                    <a href="/comments/{{ comment.id }}/delete"><i class="fa-solid fa-trash" id="trash-bin"></i></a>
                    <br>
                    {{ comment.message }}
                    <br>
                {% endfor %}
            {% endif %}
            <button id="hidingButton" class="w3-button w3-black" onclick="openForm()">POST A COMMENT</button>
            <div class="formpopup" id="hidingForm">
                <form action="/question/{{ question.id }}/new-comment" method="POST" enctype=multipart/form-data>
                    <label for="question-comment">Your comment:<br></label>
                    <textarea id="question-comment" name="question-comment" cols="40" rows="5"></textarea>
                    <br><br>
                    <input type="submit" id="small-button" value="SEND" class="w3-button w3-black">
                    <button id="small-button" type="button" class="w3-button w3-black" onclick="closeForm()">CANCEL
                    </button>
                </form>
            </div>
        </div>
    </div>

    {% if answers|length > 0 %}
        <h1 style="width:60%;">{{ answers|length }} Answers:</h1>
    {% else %}
        <h1 style="width:60%;">Answers:</h1>
    {% endif %}
    {% if answers|length > 0 %}
        <div class="questions-all">
            {% for answer in answers %}
                <div class="single-question">
                    Added on {{ answer.submission_time }}, Vote Number: {{ answer.vote_number }}
                    <br>
                    <a href='/answer/{{ answer.id }}/vote-up'><i id="circle-up"
                                                                 class="fa-sharp fa-solid fa-circle-up"></i></a>
                    <a href='/answer/{{ answer.id }}/vote-down'><i id="circle-down"
                                                                   class="fa-sharp fa-solid fa-circle-down"></i></a>
                    <br>
                    <p style="font-size: 20px;">{{ answer.message }}</p>
                    {% if answer.image != '' %}
                        <h4>Attachements:</h4>
                        {% set answer_image='images/' ~ answer.image %}
                        <img src="{{ url_for('static', filename=answer_image) }}" style="width:60px;height:50px;">
                    {% endif %}
                    <br><br>
                    <a href="/answer/{{ answer.id }}/delete">
                        <button class="w3-button w3-black" type="submit" id="small-button">DELETE THIS ANSWER
                        </button>
                    </a>
                    <br><br>
                    Comments for this answer:
                    {% for comment in comments_for_answers %}
                        {% if comment.answer_id == answer.id %}
                            <br>Added on {{ comment.submission_time }}, Edit numbers: {{ comment.edited_count }}
                            <a href="/comments/{{ comment.id }}/delete"><i class="fa-solid fa-trash" id="trash-bin"></i></a>
                            <br>
                            {{ comment.message }}
                        {% endif %}
                    {% endfor %}
                    <form action="/answer/{{ answer.id }}/new-comment" method="POST"
                          enctype=multipart/form-data>
                        <label for="question-comment">Your comment:<br></label>
                        <textarea id="question-comment" name="question-comment" cols="40" rows="5"></textarea>
                        <br><br>
                        <input type="submit" id="small-button" value="SEND" class="w3-button w3-black">
                        <button id="small-button" type="button" class="w3-button w3-black" onclick="closeForm()">
                            CANCEL
                        </button>
                    </form>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <h1>No answers</h1>
    {% endif %}
    <br><br>
    <div class="w3-center">
        <form action="/question/{{ question.id }}/add-answer" method="POST" enctype=multipart/form-data>
            <label for="answer">Your answer:<br></label>
            <textarea id="answer" name="answer" cols="80" rows="10"></textarea>
            <br><br>
            <label for="image">Add an image:<br></label>
            <input name='img' id="image" type="file" class="w3-button w3-white">
            <br><br>
            <input type="submit" value="Post an answer" class="w3-button w3-black">
        </form>
    </div>
    <script>
        function openForm() {
            document.getElementById("hidingForm").style.display = "block";
            document.getElementById("hidingButton").style.display = "none";
        }

        function closeForm() {
            document.getElementById("hidingForm").style.display = "none";
            document.getElementById("hidingButton").style.display = "block";
        }
    </script>
{% endblock %}